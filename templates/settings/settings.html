<!doctype html>
<html lang="en" data-bs-theme="auto">
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.122.0">
    <title>iBuzz2 - Settings</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/starter-template/">

    

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">

<link href="templates\bootstrap.css" rel="stylesheet" crossorigin="anonymous">

<meta name="theme-color" content="#712cf9">
    
  </head>
  <body onload="setup()">

<div class="col-lg-8 mx-auto p-4 py-md-5">
  <header class="d-flex align-items-center pb-3 mb-5 border-bottom">
    <a href="/dashboard" class="d-flex align-items-center text-body-emphasis text-decoration-none">
      <svg class="bi me-2" width="40" height="32"><use xlink:href="#bootstrap"/></svg>
      <span class="fs-4">Settings</span>
    </a>
  </header>

  <h5>Add Notification</h5>

    <div class="mb-3">
      <label for="exampleSelect" class="form-label">Serial Number</label>
      <select class="form-select" id="notification_serial_number">
        <option selected="selected" value="">Serial Number</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="exampleSelect" class="form-label">Hive Number</label>
      <select class="form-select" id="notification_hive_number">
        <option selected="selected" value="">Please select serial_number first</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="exampleSelect" class="form-label">Sensor</label>
      <select class="form-select" id="notification_sensor">
        <option selected="selected" value="">Sensor</option>
      </select>
    </div>
    <fieldset class="mb-3">
      <div class="form-check">
        <input type="radio" name="radios" class="form-check-input" value="l" id="notification_less_then">
        <label class="form-check-label" for="exampleRadio1">Less Than</label>
      </div>
      <div class="mb-3 form-check">
        <input type="radio" name="radios" class="form-check-input" value="g" id="notification_greater_than">
        <label class="form-check-label" for="exampleRadio2">Greater Than</label>
      </div>
    </fieldset>
    <div class="mb-3">
      <label for="exampleInputEmail1" class="form-label">Threshold Value</label>
      <input type="number" step="0.1" class="form-control" id="notification_value">
    </div>
    <button class="btn btn-primary" onclick="submit_notification_form()">Add Notification</button>

    <div style="padding: 30px;"></div>

  <h5>Your Existing Notifications</h5>
  <ul class="list-group" id="notification_list"></ul>
  
  <footer class="pt-5 my-5 text-body-secondary border-top">
    Template originally created by the Bootstrap team &middot; &copy; 2024
  </footer>
</div>
<script src="templates\bootstrap.js" crossorigin="anonymous"></script>
<script>

  function setup() {
    list_notifications()
    add_notification_serial_number_options()
    add_notification_sensor_options()
  }

  function fetch_notifications() {
    return fetch('/notifications').then(r => r.json()).then(j => j['notifications'])
  }

  function delete_notification(notification_id) {
    fetch('/remove_notification/' + notification_id)
  }

  function notification_li(notification) {
    let li = document.createElement("li")
    li.setAttribute("class", "alert-dismissible fade show list-group-item")
    li.setAttribute("aria-disabled", "true")
    li.innerText = "Serial Number: " + notification[2] + ", Hive Number: " + notification[3] + ", " + notification[4] + " " + notification[5] + " " + notification[6]
    let button = document.createElement("button")
    button.setAttribute("type", "button")
    button.setAttribute("class", "btn-close")
    button.setAttribute("data-bs-dismiss", "alert")
    button.setAttribute("aria-label", "Close")
    let notification_id = notification[0]
    button.addEventListener("click", function() {
      li.setAttribute("class", li.getAttribute("class") + " disabled")
      delete_notification(notification_id)
      refresh_notifications_list()
    }, false)
    li.appendChild(button)
    return li
  }

  function no_notifications_li() {
    let li = document.createElement("li")
    li.setAttribute("class", "alert-dismissible fade show list-group-item")
    li.setAttribute("aria-disabled", "true")
    li.innerText = "You have no notifications. Create some above."
    return li
  }

  function list_notifications() {
    fetch_notifications().then(notifications => {
      let parent = document.getElementById("notification_list")
      if (notifications.length === 0) {
        let li = no_notifications_li()
        parent.appendChild(li)
      }
      else {
        notifications.forEach(notification => {
          console.log(notification)
          let li = notification_li(notification)
          parent.appendChild(li)
        });
      }
    })
  }

  function refresh_notifications_list() {
    let parent = document.getElementById("notification_list")
    parent.innerHTML = ""
    list_notifications()
  }

  function fetch_visible_serial_numbers() {
    return fetch('/serial_numbers').then(r => r.json()).then(j => j['serial_numbers'])
  }

  function add_notification_serial_number_options() {
    fetch_visible_serial_numbers().then(serial_numbers => {
      let parent = document.getElementById("notification_serial_number")
      parent.onchange = function() {
        add_hive_number_options(this.value)
      }
      serial_numbers.forEach(serial_number => {
        let option = document.createElement("option")
        option.setAttribute("value", serial_number[0])
        option.innerText = serial_number[0]
        parent.appendChild(option)
      });
    })
  }

  function fetch_hive_numbers(serial_number) {
    return fetch('/hive_numbers/' + serial_number).then(r => r.json()).then(j => j['hive_numbers'])
  }

  function add_hive_number_options(serial_number) {
    fetch_hive_numbers(serial_number).then(hive_numbers => {
      let parent = document.getElementById("notification_hive_number")
      parent.length = 1
      hive_numbers.forEach(hive_number => {
        let option = document.createElement("option")
        option.setAttribute("value", hive_number)
        option.innerText = hive_number
        parent.appendChild(option)
      });
    })
  }

  function fetch_sensor_names() {
    return fetch('/names').then(r => r.json()).then(j => j['names'])
  }

  function add_notification_sensor_options() {
    fetch_sensor_names().then(names => {
      let parent = document.getElementById("notification_sensor")
      names.forEach(name => {
        if (name != "time" && name != "serial_number" && name != "hive_number") {
          let option = document.createElement("option")
          option.setAttribute("value", name)
          option.innerText = name
          parent.appendChild(option)
        }
      });
    })
  }

  function submit_notification_form() {
    let serial_number = document.getElementById("notification_serial_number").value
    let hive_number = document.getElementById("notification_hive_number").value
    let sensor = document.getElementById("notification_sensor").value
    let sign = document.querySelector('input[name="radios"]:checked').value
    if (sign === "l") {
      sign = '<'
    }
    else {
      sign = '>'
    }
    let value = document.getElementById("notification_value").value

    console.log('/add_notification/' + serial_number + "/" + hive_number + "/" + sensor + "/" + sign + "/" + value)
    fetch('/add_notification/' + serial_number + "/" + hive_number + "/" + sensor + "/" + sign + "/" + value).then(r => refresh_notifications_list())
  }

</script>

    </body>
</html>
